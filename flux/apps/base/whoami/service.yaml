apiVersion: v1
kind: Service
metadata:
  name: whoami
  labels:
    app.kubernetes.io/name: whoami
spec:
  selector:
    app.kubernetes.io/name: whoami
  ports:
    - name: web
      protocol: TCP
      port: 80
      targetPort: web
---
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  labels:
    app.kubernetes.io/name: whoami
  name: whoami
spec:
  gateways:
    - istio-system/gateway
  hosts:
    - whoami.stehessel.org
  http:
    - route:
        - destination:
            host: whoami.whoami.svc.cluster.local
            port:
              number: 80
