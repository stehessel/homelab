apiVersion: install.istio.io/v1alpha1
kind: IstioOperator
spec:
  meshConfig:
    accessLogFile: /dev/stdout
    enablePrometheusMerge: false
    extensionProviders:
      - name: oauth2-proxy
        envoyExtAuthzHttp:
          service: oauth2-proxy.oauth2-proxy.svc.cluster.local
          port: "80"
          includeRequestHeadersInCheck:
            - Authorization
            - Cookie
            - X-Auth-Request-Redirect
          includeAdditionalHeadersInCheck:
            X-Auth-Request-Redirect: https://%REQ(Host)%/%REQ(:PATH)%
          headersToUpstreamOnAllow:
            - Authorization
            - Path
            - X-Auth-Request-Email
            - X-Auth-Request-Preferred-Username
            - X-Auth-Request-User
          headersToDownstreamOnDeny:
            - Content-Type
            - Set-Cookie
